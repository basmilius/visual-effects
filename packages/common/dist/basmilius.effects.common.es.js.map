{"version":3,"file":"basmilius.effects.common.es.js","sources":["../src/canvas.ts","../src/distance.ts","../src/mulberry32.ts"],"sourcesContent":["export class LimitedFrameRateCanvas {\n    private readonly _canvas: HTMLCanvasElement;\n    private readonly _context: CanvasRenderingContext2D;\n    private _current: number = 0;\n    private _delta: number = 0;\n    private _frame: number = 0;\n    private readonly _frameRate: number;\n    private _now: number = 0;\n    private readonly _target: number;\n    private _then: number = 0;\n    private _ticks: number = 0;\n    private _isStopped: boolean = false;\n\n    private _height: number = 540;\n    private _width: number = 960;\n\n    private readonly _boundOnVisibilityChange: (evt: Event) => void;\n    private readonly _boundOnResize: (evt: Event) => void;\n\n    public get canvas(): HTMLCanvasElement {\n        return this._canvas;\n    }\n\n    public get context(): CanvasRenderingContext2D {\n        return this._context;\n    }\n\n    public get delta(): number {\n        return this._delta;\n    }\n\n    public get deltaFactor(): number {\n        return this._then === 0 ? 1 : this._target / this._delta;\n    }\n\n    public get frameRate(): number {\n        return this._frameRate;\n    }\n\n    public get isSmall(): boolean {\n        return innerWidth < 991; // dirty little fix :-)\n    }\n\n    public get ticks(): number {\n        return this._ticks;\n    }\n\n    public get height(): number {\n        return this._height;\n    }\n\n    public get width(): number {\n        return this._width;\n    }\n\n    constructor(canvas: HTMLCanvasElement, frameRate: number) {\n        this._canvas = canvas;\n        this._context = canvas.getContext(\"2d\", {colorSpace: \"display-p3\"});\n        this._frameRate = frameRate;\n        this._target = 1000 / frameRate;\n\n        this._boundOnVisibilityChange = this.onVisibilityChange.bind(this);\n        this._boundOnResize = this.onResize.bind(this);\n\n        document.addEventListener(\"visibilitychange\", this._boundOnVisibilityChange, {passive: true});\n        window.addEventListener(\"resize\", this._boundOnResize, {passive: true});\n    }\n\n    loop(): void {\n        if (this._isStopped) {\n            return;\n        }\n\n        this._current = Date.now();\n        this._frame = requestAnimationFrame(this.loop.bind(this));\n\n        if (this._then > 0 && this._current - this._then + 1 < this._target) {\n            return;\n        }\n\n        this._now = this._current;\n        this._delta = this._now - this._then;\n\n        ++this._ticks;\n\n        this.tick();\n        this.draw();\n\n        this._then = this._now;\n    }\n\n    start(): void {\n        this.onResize();\n\n        this._isStopped = false;\n        this._frame = requestAnimationFrame(this.loop.bind(this));\n    }\n\n    stop(): void {\n        this._isStopped = true;\n        cancelAnimationFrame(this._frame);\n    }\n\n    draw(): void {\n        throw new Error(\"LimitedFrameRateCanvas::draw() should be overwritten.\")\n    }\n\n    tick(): void {\n        throw new Error(\"LimitedFrameRateCanvas::tick() should be overwritten.\")\n    }\n\n    destroy(): void {\n        document.removeEventListener(\"visibilitychange\", this._boundOnVisibilityChange);\n        window.removeEventListener(\"resize\", this._boundOnResize);\n    }\n\n    onResize(): void {\n        const {width, height} = this._canvas.getBoundingClientRect();\n        this._height = height;\n        this._width = width;\n    }\n\n    onVisibilityChange(): void {\n        cancelAnimationFrame(this._frame);\n\n        if (document.visibilityState === \"visible\") {\n            this._then = 0;\n            this.start();\n        } else {\n            this._then = 0;\n            this.stop();\n        }\n    }\n}\n","import { Point } from \"./point\";\n\nexport function distance(a: Point, b: Point): number {\n\tlet x = a.x - b.x;\n\tlet y = a.y - b.y;\n\n\treturn Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));\n}\n","export function mulberry32(seed?: number): Mulberry32 {\n\tconst state = new Uint32Array(1);\n\tstate[0] = seed;\n\n\tfunction next(): number {\n\t\tconst innerState = (state[0] = (state[0] + 0x6d2b79f5) | 0);\n\t\tlet t = Math.imul(innerState ^ (innerState >>> 15), 1 | innerState);\n\t\tt = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;\n\n\t\treturn ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n\t}\n\n\tfunction nextBetween(from: number, to: number): number {\n\t\treturn this.next() * (to - from) + from;\n\t}\n\n\tfunction fork(): Mulberry32 {\n\t\treturn mulberry32(this.next() * 2 ** 32);\n\t}\n\n\treturn {\n\t\tfork,\n\t\tnext,\n\t\tnextBetween\n\t};\n}\n\nexport interface Mulberry32 {\n\tfork(): Mulberry32;\n\n\tnext(): number;\n\n\tnextBetween(min: number, max: number): number;\n}\n"],"names":["LimitedFrameRateCanvas","constructor","canvas","frameRate","this","_canvas","_context","getContext","colorSpace","_frameRate","_target","_boundOnVisibilityChange","onVisibilityChange","bind","_boundOnResize","onResize","document","addEventListener","passive","window","context","delta","_delta","deltaFactor","_then","isSmall","innerWidth","ticks","_ticks","height","_height","width","_width","loop","_isStopped","_current","Date","now","_frame","requestAnimationFrame","_now","tick","draw","start","stop","cancelAnimationFrame","Error","destroy","removeEventListener","getBoundingClientRect","visibilityState","distance","a","b","x","y","Math","sqrt","pow","mulberry32","seed","state","Uint32Array","fork","next","innerState","t","imul","nextBetween","from","to"],"mappings":"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"}