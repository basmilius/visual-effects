{"version":3,"file":"basmilius.effects.common.js","sources":["../src/canvas.ts","../src/distance.ts","../src/mulberry32.ts"],"sourcesContent":["export class LimitedFrameRateCanvas {\n\tprivate readonly _canvas: HTMLCanvasElement;\n\tprivate readonly _context: CanvasRenderingContext2D;\n\tprivate _current: number = 0;\n\tprivate _delta: number = 0;\n\tprivate _frame: number = 0;\n\tprivate readonly _frameRate: number;\n\tprivate _now: number = 0;\n\tprivate readonly _target: number;\n\tprivate _then: number = 0;\n\tprivate _ticks: number = 0;\n\tprivate _isStopped: boolean = false;\n\n\tprivate _height: number = 540;\n\tprivate _width: number = 960;\n\n\tpublic get canvas(): HTMLCanvasElement {\n\t\treturn this._canvas;\n\t}\n\n\tpublic get context(): CanvasRenderingContext2D {\n\t\treturn this._context;\n\t}\n\n\tpublic get delta(): number {\n\t\treturn this._delta;\n\t}\n\n\tpublic get deltaFactor(): number {\n\t\treturn this._then === 0 ? 1 : this._target / this._delta;\n\t}\n\n\tpublic get frameRate(): number {\n\t\treturn this._frameRate;\n\t}\n\n\tpublic get isSmall(): boolean {\n\t\treturn innerWidth < 991; // dirty little fix :-)\n\t}\n\n\tpublic get ticks(): number {\n\t\treturn this._ticks;\n\t}\n\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\n\tpublic get width(): number {\n\t\treturn this._width;\n\t}\n\n\tconstructor(canvas: HTMLCanvasElement, frameRate: number) {\n\t\tthis._canvas = canvas;\n\t\tthis._context = canvas.getContext(\"2d\");\n\t\tthis._frameRate = frameRate;\n\t\tthis._target = 1000 / frameRate;\n\n\t\tdocument.addEventListener(\"visibilitychange\", this.onVisibilityChange.bind(this), {passive: true});\n\t\twindow.addEventListener(\"resize\", this.onResize.bind(this), {passive: true});\n\t}\n\n\tloop(): void {\n\t\tif (this._isStopped) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._current = Date.now();\n\t\tthis._frame = requestAnimationFrame(this.loop.bind(this));\n\n\t\tif (this._then > 0 && this._current - this._then + 1 < this._target) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._now = this._current;\n\t\tthis._delta = this._now - this._then;\n\n\t\t++this._ticks;\n\n\t\tthis.tick();\n\t\tthis.draw();\n\n\t\tthis._then = this._now;\n\t}\n\n\tstart(): void {\n\t\tthis.onResize();\n\n\t\tthis._isStopped = false;\n\t\tthis._frame = requestAnimationFrame(this.loop.bind(this));\n\t}\n\n\tstop(): void {\n\t\tthis._isStopped = true;\n\t\tcancelAnimationFrame(this._frame);\n\t}\n\n\tdraw(): void {\n\t\tthrow new Error(\"LimitedFrameRateCanvas::draw() should be overwritten.\")\n\t}\n\n\ttick(): void {\n\t\tthrow new Error(\"LimitedFrameRateCanvas::tick() should be overwritten.\")\n\t}\n\n\tonResize(): void {\n\t\tconst {width, height} = this._canvas.getBoundingClientRect();\n\t\tthis._height = height;\n\t\tthis._width = width;\n\t}\n\n\tonVisibilityChange(): void {\n\t\tcancelAnimationFrame(this._frame);\n\n\t\tif (document.visibilityState === \"visible\") {\n\t\t\tthis._then = 0;\n\t\t\tthis.start();\n\t\t} else {\n\t\t\tthis._then = 0;\n\t\t\tthis.stop();\n\t\t}\n\t}\n}\n","import { Point } from \"./point\";\n\nexport function distance(a: Point, b: Point): number {\n\tlet x = a.x - b.x;\n\tlet y = a.y - b.y;\n\n\treturn Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));\n}\n","export function mulberry32(seed?: number): Mulberry32 {\n\tconst state = new Uint32Array(1);\n\tstate[0] = seed;\n\n\tfunction next(): number {\n\t\tconst innerState = (state[0] = (state[0] + 0x6d2b79f5) | 0);\n\t\tlet t = Math.imul(innerState ^ (innerState >>> 15), 1 | innerState);\n\t\tt = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;\n\n\t\treturn ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n\t}\n\n\tfunction nextBetween(from: number, to: number): number {\n\t\treturn this.next() * (to - from) + from;\n\t}\n\n\tfunction fork(): Mulberry32 {\n\t\treturn mulberry32(this.next() * 2 ** 32);\n\t}\n\n\treturn {\n\t\tfork,\n\t\tnext,\n\t\tnextBetween\n\t};\n}\n\nexport interface Mulberry32 {\n\tfork(): Mulberry32;\n\n\tnext(): number;\n\n\tnextBetween(min: number, max: number): number;\n}\n"],"names":["constructor","canvas","frameRate","this","_canvas","_context","getContext","_frameRate","_target","document","addEventListener","onVisibilityChange","bind","passive","window","onResize","context","delta","_delta","deltaFactor","_then","isSmall","innerWidth","ticks","_ticks","height","_height","width","_width","loop","_isStopped","_current","Date","now","_frame","requestAnimationFrame","_now","tick","draw","start","stop","cancelAnimationFrame","Error","getBoundingClientRect","visibilityState","a","b","x","y","Math","sqrt","pow","mulberry32","seed","state","Uint32Array","fork","next","innerState","t","imul","nextBetween","from","to"],"mappings":"yGAoDCA,YAAYC,EAA2BC,GAjD/BC,cAAmB,EACnBA,YAAiB,EACjBA,YAAiB,EAEjBA,UAAe,EAEfA,WAAgB,EAChBA,YAAiB,EACjBA,iBAAsB,EAEtBA,aAAkB,IAClBA,YAAiB,IAuCxBA,KAAKC,QAAUH,EACfE,KAAKE,SAAWJ,EAAOK,WAAW,MAClCH,KAAKI,WAAaL,EAClBC,KAAKK,QAAU,IAAON,EAEtBO,SAASC,iBAAiB,mBAAoBP,KAAKQ,mBAAmBC,KAAKT,MAAO,CAACU,SAAS,IAC5FC,OAAOJ,iBAAiB,SAAUP,KAAKY,SAASH,KAAKT,MAAO,CAACU,SAAS,IA3C5DZ,aACV,OAAOE,KAAKC,QAGFY,cACV,OAAOb,KAAKE,SAGFY,YACV,OAAOd,KAAKe,OAGFC,kBACV,OAAsB,IAAfhB,KAAKiB,MAAc,EAAIjB,KAAKK,QAAUL,KAAKe,OAGxChB,gBACV,OAAOC,KAAKI,WAGFc,cACV,OAAOC,WAAa,IAGVC,YACV,OAAOpB,KAAKqB,OAGFC,aACV,OAAOtB,KAAKuB,QAGFC,YACV,OAAOxB,KAAKyB,OAabC,OACK1B,KAAK2B,aAIT3B,KAAK4B,SAAWC,KAAKC,MACrB9B,KAAK+B,OAASC,sBAAsBhC,KAAK0B,KAAKjB,KAAKT,OAE/CA,KAAKiB,MAAQ,GAAKjB,KAAK4B,SAAW5B,KAAKiB,MAAQ,EAAIjB,KAAKK,UAI5DL,KAAKiC,KAAOjC,KAAK4B,SACjB5B,KAAKe,OAASf,KAAKiC,KAAOjC,KAAKiB,QAE7BjB,KAAKqB,OAEPrB,KAAKkC,OACLlC,KAAKmC,OAELnC,KAAKiB,MAAQjB,KAAKiC,OAGnBG,QACCpC,KAAKY,WAELZ,KAAK2B,YAAa,EAClB3B,KAAK+B,OAASC,sBAAsBhC,KAAK0B,KAAKjB,KAAKT,OAGpDqC,OACCrC,KAAK2B,YAAa,EAClBW,qBAAqBtC,KAAK+B,QAG3BI,OACC,MAAM,IAAII,MAAM,yDAGjBL,OACC,MAAM,IAAIK,MAAM,yDAGjB3B,WACC,MAAMY,MAACA,EAAKF,OAAEA,GAAUtB,KAAKC,QAAQuC,wBACrCxC,KAAKuB,QAAUD,EACftB,KAAKyB,OAASD,EAGfhB,qBACC8B,qBAAqBtC,KAAK+B,QAEO,YAA7BzB,SAASmC,iBACZzC,KAAKiB,MAAQ,EACbjB,KAAKoC,UAELpC,KAAKiB,MAAQ,EACbjB,KAAKqC,oCCrHiBK,EAAUC,GAClC,IAAIC,EAAIF,EAAEE,EAAID,EAAEC,EACZC,EAAIH,EAAEG,EAAIF,EAAEE,EAEhB,OAAOC,KAAKC,KAAKD,KAAKE,IAAIJ,EAAG,GAAKE,KAAKE,IAAIH,EAAG,iCCN/BI,EAAWC,GAC1B,MAAMC,EAAQ,IAAIC,YAAY,GAmB9B,OAlBAD,EAAM,GAAKD,EAkBJ,CACNG,KALD,WACC,OAAOJ,EAAWjD,KAAKsD,OAASR,SAAA,EAAK,MAKrCQ,KAlBD,WACC,MAAMC,EAAcJ,EAAM,GAAMA,EAAM,GAAK,WAAc,EACzD,IAAIK,EAAIV,KAAKW,KAAKF,EAAcA,IAAe,GAAK,EAAIA,GAGxD,OAFAC,EAAKA,EAAIV,KAAKW,KAAKD,EAAKA,IAAM,EAAI,GAAKA,GAAMA,IAEpCA,EAAKA,IAAM,MAAS,GAAK,YAclCE,YAXD,SAAqBC,EAAcC,GAClC,OAAO5D,KAAKsD,QAAUM,EAAKD,GAAQA"}