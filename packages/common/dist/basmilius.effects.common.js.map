{"version":3,"file":"basmilius.effects.common.js","sources":["../src/canvas.ts","../src/distance.ts","../src/mulberry32.ts"],"sourcesContent":["export class LimitedFrameRateCanvas {\n\tprivate readonly _canvas: HTMLCanvasElement;\n\tprivate readonly _context: CanvasRenderingContext2D;\n\tprivate _current: number = 0;\n\tprivate _delta: number = 0;\n\tprivate _frame: number = 0;\n\tprivate readonly _frameRate: number;\n\tprivate _now: number = 0;\n\tprivate readonly _target: number;\n\tprivate _then: number = 0;\n\tprivate _ticks: number = 0;\n\tprivate _isStopped: boolean = false;\n\n\tprivate _height: number = 540;\n\tprivate _width: number = 960;\n\n\tpublic get canvas(): HTMLCanvasElement {\n\t\treturn this._canvas;\n\t}\n\n\tpublic get context(): CanvasRenderingContext2D {\n\t\treturn this._context;\n\t}\n\n\tpublic get delta(): number {\n\t\treturn this._delta;\n\t}\n\n\tpublic get deltaFactor(): number {\n\t\treturn this._then === 0 ? 1 : this._target / this._delta;\n\t}\n\n\tpublic get frameRate(): number {\n\t\treturn this._frameRate;\n\t}\n\n\tpublic get isSmall(): boolean {\n\t\treturn innerWidth < 991; // dirty little fix :-)\n\t}\n\n\tpublic get ticks(): number {\n\t\treturn this._ticks;\n\t}\n\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\n\tpublic get width(): number {\n\t\treturn this._width;\n\t}\n\n\tconstructor(canvas: HTMLCanvasElement, frameRate: number) {\n\t\tthis._canvas = canvas;\n\t\tthis._context = canvas.getContext(\"2d\", {colorSpace: \"display-p3\"});\n\t\tthis._frameRate = frameRate;\n\t\tthis._target = 1000 / frameRate;\n\n\t\tdocument.addEventListener(\"visibilitychange\", this.onVisibilityChange.bind(this), {passive: true});\n\t\twindow.addEventListener(\"resize\", this.onResize.bind(this), {passive: true});\n\t}\n\n\tloop(): void {\n\t\tif (this._isStopped) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._current = Date.now();\n\t\tthis._frame = requestAnimationFrame(this.loop.bind(this));\n\n\t\tif (this._then > 0 && this._current - this._then + 1 < this._target) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._now = this._current;\n\t\tthis._delta = this._now - this._then;\n\n\t\t++this._ticks;\n\n\t\tthis.tick();\n\t\tthis.draw();\n\n\t\tthis._then = this._now;\n\t}\n\n\tstart(): void {\n\t\tthis.onResize();\n\n\t\tthis._isStopped = false;\n\t\tthis._frame = requestAnimationFrame(this.loop.bind(this));\n\t}\n\n\tstop(): void {\n\t\tthis._isStopped = true;\n\t\tcancelAnimationFrame(this._frame);\n\t}\n\n\tdraw(): void {\n\t\tthrow new Error(\"LimitedFrameRateCanvas::draw() should be overwritten.\")\n\t}\n\n\ttick(): void {\n\t\tthrow new Error(\"LimitedFrameRateCanvas::tick() should be overwritten.\")\n\t}\n\n\tonResize(): void {\n\t\tconst {width, height} = this._canvas.getBoundingClientRect();\n\t\tthis._height = height;\n\t\tthis._width = width;\n\t}\n\n\tonVisibilityChange(): void {\n\t\tcancelAnimationFrame(this._frame);\n\n\t\tif (document.visibilityState === \"visible\") {\n\t\t\tthis._then = 0;\n\t\t\tthis.start();\n\t\t} else {\n\t\t\tthis._then = 0;\n\t\t\tthis.stop();\n\t\t}\n\t}\n}\n","import { Point } from \"./point\";\n\nexport function distance(a: Point, b: Point): number {\n\tlet x = a.x - b.x;\n\tlet y = a.y - b.y;\n\n\treturn Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));\n}\n","export function mulberry32(seed?: number): Mulberry32 {\n\tconst state = new Uint32Array(1);\n\tstate[0] = seed;\n\n\tfunction next(): number {\n\t\tconst innerState = (state[0] = (state[0] + 0x6d2b79f5) | 0);\n\t\tlet t = Math.imul(innerState ^ (innerState >>> 15), 1 | innerState);\n\t\tt = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;\n\n\t\treturn ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n\t}\n\n\tfunction nextBetween(from: number, to: number): number {\n\t\treturn this.next() * (to - from) + from;\n\t}\n\n\tfunction fork(): Mulberry32 {\n\t\treturn mulberry32(this.next() * 2 ** 32);\n\t}\n\n\treturn {\n\t\tfork,\n\t\tnext,\n\t\tnextBetween\n\t};\n}\n\nexport interface Mulberry32 {\n\tfork(): Mulberry32;\n\n\tnext(): number;\n\n\tnextBetween(min: number, max: number): number;\n}\n"],"names":["constructor","canvas","frameRate","this","_canvas","_context","getContext","colorSpace","_frameRate","_target","document","addEventListener","onVisibilityChange","bind","passive","window","onResize","context","delta","_delta","deltaFactor","_then","isSmall","innerWidth","ticks","_ticks","height","_height","width","_width","loop","_isStopped","_current","Date","now","_frame","requestAnimationFrame","_now","tick","draw","start","stop","cancelAnimationFrame","Error","getBoundingClientRect","visibilityState","a","b","x","y","Math","sqrt","pow","mulberry32","seed","state","Uint32Array","fork","next","innerState","t","imul","nextBetween","from","to"],"mappings":"yGAoDCA,YAAYC,EAA2BC,GAjD/BC,cAAmB,EACnBA,YAAiB,EACjBA,YAAiB,EAEjBA,UAAe,EAEfA,WAAgB,EAChBA,YAAiB,EACjBA,iBAAsB,EAEtBA,aAAkB,IAClBA,YAAiB,IAuCxBA,KAAKC,QAAUH,EACfE,KAAKE,SAAWJ,EAAOK,WAAW,KAAM,CAACC,WAAY,eACrDJ,KAAKK,WAAaN,EAClBC,KAAKM,QAAU,IAAOP,EAEtBQ,SAASC,iBAAiB,mBAAoBR,KAAKS,mBAAmBC,KAAKV,MAAO,CAACW,SAAS,IAC5FC,OAAOJ,iBAAiB,SAAUR,KAAKa,SAASH,KAAKV,MAAO,CAACW,SAAS,IA3C5Db,aACV,OAAOE,KAAKC,QAGFa,cACV,OAAOd,KAAKE,SAGFa,YACV,OAAOf,KAAKgB,OAGFC,kBACV,OAAsB,IAAfjB,KAAKkB,MAAc,EAAIlB,KAAKM,QAAUN,KAAKgB,OAGxCjB,gBACV,OAAOC,KAAKK,WAGFc,cACV,OAAOC,WAAa,IAGVC,YACV,OAAOrB,KAAKsB,OAGFC,aACV,OAAOvB,KAAKwB,QAGFC,YACV,OAAOzB,KAAK0B,OAabC,OACK3B,KAAK4B,aAIT5B,KAAK6B,SAAWC,KAAKC,MACrB/B,KAAKgC,OAASC,sBAAsBjC,KAAK2B,KAAKjB,KAAKV,OAE/CA,KAAKkB,MAAQ,GAAKlB,KAAK6B,SAAW7B,KAAKkB,MAAQ,EAAIlB,KAAKM,UAI5DN,KAAKkC,KAAOlC,KAAK6B,SACjB7B,KAAKgB,OAAShB,KAAKkC,KAAOlC,KAAKkB,QAE7BlB,KAAKsB,OAEPtB,KAAKmC,OACLnC,KAAKoC,OAELpC,KAAKkB,MAAQlB,KAAKkC,OAGnBG,QACCrC,KAAKa,WAELb,KAAK4B,YAAa,EAClB5B,KAAKgC,OAASC,sBAAsBjC,KAAK2B,KAAKjB,KAAKV,OAGpDsC,OACCtC,KAAK4B,YAAa,EAClBW,qBAAqBvC,KAAKgC,QAG3BI,OACC,MAAM,IAAII,MAAM,yDAGjBL,OACC,MAAM,IAAIK,MAAM,yDAGjB3B,WACC,MAAMY,MAACA,EAAKF,OAAEA,GAAUvB,KAAKC,QAAQwC,wBACrCzC,KAAKwB,QAAUD,EACfvB,KAAK0B,OAASD,EAGfhB,qBACC8B,qBAAqBvC,KAAKgC,QAEO,YAA7BzB,SAASmC,iBACZ1C,KAAKkB,MAAQ,EACblB,KAAKqC,UAELrC,KAAKkB,MAAQ,EACblB,KAAKsC,oCCrHiBK,EAAUC,GAClC,IAAIC,EAAIF,EAAEE,EAAID,EAAEC,EACZC,EAAIH,EAAEG,EAAIF,EAAEE,EAEhB,OAAOC,KAAKC,KAAKD,KAAKE,IAAIJ,EAAG,GAAKE,KAAKE,IAAIH,EAAG,iCCN/BI,EAAWC,GAC1B,MAAMC,EAAQ,IAAIC,YAAY,GAmB9B,OAlBAD,EAAM,GAAKD,EAkBJ,CACNG,KALD,WACC,OAAOJ,EAAWlD,KAAKuD,OAASR,SAAA,EAAK,MAKrCQ,KAlBD,WACC,MAAMC,EAAcJ,EAAM,GAAMA,EAAM,GAAK,WAAc,EACzD,IAAIK,EAAIV,KAAKW,KAAKF,EAAcA,IAAe,GAAK,EAAIA,GAGxD,OAFAC,EAAKA,EAAIV,KAAKW,KAAKD,EAAKA,IAAM,EAAI,GAAKA,GAAMA,IAEpCA,EAAKA,IAAM,MAAS,GAAK,YAclCE,YAXD,SAAqBC,EAAcC,GAClC,OAAO7D,KAAKuD,QAAUM,EAAKD,GAAQA"}