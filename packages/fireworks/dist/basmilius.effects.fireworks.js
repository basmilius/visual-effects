"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@basmilius/effects-common");const i=t.mulberry32();class s extends EventTarget{constructor(t,s,e){for(super(),this.friction=.95,this.gravity=1,this.trail=[],this.trailMemory=5,this.position=Object.assign({},t),this.alpha=1,this.angle=i.nextBetween(0,2*Math.PI),this.brightness=i.nextBetween(50,80),this.decay=i.nextBetween(.015,.03),this.hue=s+i.nextBetween(-50,50),this.lineWidth=e,this.speed=i.nextBetween(1,10);this.trailMemory--;)this.trail.push(Object.assign({},t))}draw(t){const i=this.trail[this.trail.length-1];t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(this.position.x,this.position.y),t.lineCap="round",t.lineWidth=this.lineWidth,t.strokeStyle=`hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`,t.stroke()}tick(){this.trail.pop(),this.trail.unshift(Object.assign({},this.position)),this.speed*=this.friction,this.position.x+=Math.cos(this.angle)*this.speed,this.position.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&this.dispatchEvent(new CustomEvent("remove"))}}class e extends EventTarget{constructor(s,e,h,n){for(super(),this.acceleration=1.05,this.brightness=i.nextBetween(50,70),this.distanceTraveled=0,this.speed=1,this.targetRadius=1,this.trail=[],this.trailMemory=3,this.hue=h,this.lineWidth=n,this.position=Object.assign({},s),this.startPosition=Object.assign({},s),this.targetPosition=Object.assign({},e),this.angle=Math.atan2(e.y-s.y,e.x-s.x),this.distance=t.distance(s,e);this.trailMemory--;)this.trail.push(Object.assign({},s))}draw(t){const s=this.hue+i.nextBetween(-50,50),e=this.trail[this.trail.length-1];t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(this.position.x,this.position.y),t.lineCap="round",t.lineWidth=this.lineWidth,t.strokeStyle=`hsl(${s}, 100%, ${this.brightness}%)`,t.stroke()}tick(){this.trail.pop(),this.trail.unshift(Object.assign({},this.position)),this.targetRadius<8?this.targetRadius+=.3:this.targetRadius=1,this.speed*=this.acceleration;let i=Math.cos(this.angle)*this.speed,s=Math.sin(this.angle)*this.speed;this.distanceTraveled=t.distance(this.startPosition,{x:this.position.x+i,y:this.position.y+s}),this.distanceTraveled>=this.distance?this.dispatchEvent(new CustomEvent("remove")):(this.position.x+=i,this.position.y+=s)}}class h extends t.LimitedFrameRateCanvas{constructor(t,s=6){super(t,60),this.hue=120,this.positionRandom=i.fork(),this.explosions=[],this.fireworks=[],this.lineWidth=s,this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.height="100%",this.canvas.style.width="100%"}draw(){this.canvas.height=this.height,this.canvas.width=this.width,this.context.globalCompositeOperation="destination-out",this.context.fillStyle="rgba(0, 0, 0, 0.5)",this.context.fillRect(0,0,this.width,this.height),this.context.globalCompositeOperation="lighter",this.explosions.forEach((t=>t.draw(this.context))),this.fireworks.forEach((t=>t.draw(this.context)))}tick(){if(this.fireworks.length<6&&this.ticks%(this.isSmall?60:30)==0){let t=i.nextBetween(1,100)<10?2:1;for(;t--;)this.hue=i.nextBetween(0,360),this.createFirework()}this.explosions.forEach((t=>t.tick())),this.fireworks.forEach((t=>t.tick()))}createExplosion(t,i){let e=30;for(;e--;){const e=new s(t,i,this.lineWidth);e.addEventListener("remove",(()=>this.explosions.splice(this.explosions.indexOf(e),1)),{once:!0}),this.explosions.push(e)}}createFirework(){const t=this.hue,i=this.positionRandom.nextBetween(100,this.width-100),s=.1*this.height+this.positionRandom.nextBetween(0,.5*this.height),h=new e({x:.5*i+innerWidth/4,y:this.height},{x:i,y:s},t,this.lineWidth);h.addEventListener("remove",(()=>{this.fireworks.splice(this.fireworks.indexOf(h),1),this.createExplosion(h.position,t)}),{once:!0}),this.fireworks.push(h)}}exports.FireworkSimulation=h;//# sourceMappingURL=basmilius.effects.fireworks.js.map
